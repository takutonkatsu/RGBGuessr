<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retina</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <link rel="shortcut icon" href="Retina_icon.png">
    <link rel="apple-touch-icon" href="Retina_icon.png">    
    <link rel="icon" type="image/png" href="Retina_icon.png">
    
    <meta property="og:url" content="https://takuto1014.github.io/RGBGuessr/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Retina">
    <meta property="og:description" content="Test your color sense.">
    <meta property="og:site_name" content="Retina">
    <meta property="og:image" content="https://takuto1014.github.io/RGBGuessr/RgbGuessr共有.png">
</head>
<body>

    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>

    <header class="app-header">
        <div class="logo" id="app-logo" onclick="app.backToMenu()">
            <img src="Retina_icon.png" alt="icon" class="logo-icon">
            <span class="logo-text">RETINA</span>
        </div>
        <button id="back-btn" class="nav-btn hidden" onclick="app.backToMenu()">
            <span class="icon">✕</span> Close
        </button>
    </header>

    <main class="container">

        <section id="screen-menu" class="screen active fade-in">
            <div class="hero-section">
                <p class="hero-subtitle">Test your color sense.</p>
                <h1 class="hero-title">Master the <span class="char-r">R</span><span class="char-g">G</span><span class="char-b">B</span></h1>
            </div>

            <div class="daily-section" onclick="app.startGame('daily')">
                <div class="daily-main-container">
                    <div id="menu-daily-color-preview" class="daily-preview-large"></div>
                    <div class="daily-content">
                        <div class="daily-label">TODAY'S CHALLENGE</div>
                        <div class="daily-date" id="menu-daily-date">202X.XX.XX</div>
                        <h2 class="daily-title">Daily Color</h2>
                        <p class="daily-desc">世界共通の「今日の色」に挑戦せよ</p>
                    </div>
                </div>
                <div class="daily-status" id="menu-daily-status">PLAY NOW ►</div>
            </div>

            <div class="menu-grid">
                <div class="game-card card-original" onclick="app.startGame('original')">
                    <div class="card-icon">🧠</div>
                    <div class="card-content">
                        <h3>Origin</h3>
                        <p>数値のみで挑む真剣勝負</p>
                        <div class="record-badge" id="menu-original-record">NO RECORD</div>
                    </div>
                </div>

                <div class="game-card card-rush" onclick="app.startGame('rush')">
                    <div class="card-icon">⚡</div>
                    <div class="card-content">
                        <h3>Rush</h3>
                        <p>時間制限付きのスピード勝負</p>
                        <div class="record-badge" id="menu-rush-record">NO RECORD</div>
                    </div>
                </div>

                <div class="game-card card-challenge" onclick="app.startGame('challenge')">
                    <div class="card-icon">🔥</div>
                    <div class="card-content">
                        <h3>Survival</h3>
                        <p>極限へ至るサバイバル</p>
                        <div class="record-badge" id="menu-challenge-record">Start: Stage 1</div>
                    </div>
                </div>

                <div class="game-card card-multi" onclick="app.startGame('multi')">
                    <div class="card-icon">⚔️</div>
                    <div class="card-content">
                        <h3>Versus</h3>
                        <p>2〜4人でリアルタイム対戦</p>
                        <div class="record-badge">2-4 PLAYERS</div>
                    </div>
                </div>
            </div>
            
            <div id="another-world-entrance" class="hidden text-center" style="margin-top: 40px;">
                <button class="glitch-btn" onclick="app.triggerSecret()">ENTER THE VOID</button>
            </div>
            <div id="god-badge-area" class="text-center" style="margin-top: 20px; opacity: 0.8;"></div>
            
            <div class="about-section">
                <div class="about-title">How to Play</div>
                <div class="about-card">
                    <h4>What is RGB?</h4>
                    <p>光の三原色（Red/Green/Blue）を0〜255の数値で表現するシステム。このゲームは、あなたの網膜と脳内変換の精度を極限まで高めるトレーニングツールです。</p>
                </div>
                <div class="about-card about-original">
                    <h4>Origin</h4>
                    <p>視覚的なヒント無しでRGB数値を導き出す、ストイックなスタンダードモード。純粋な知識と色彩感覚が試される、Retinaの原点です。</p>
                </div>
                <div class="about-card about-rush">
                    <h4>Rush</h4>
                    <p>60秒間のタイムアタック。高精度（95%以上）で回答すると残り時間が増え、ミス（90%未満）すると時間が減ります。正確さと速さの両立が鍵。</p>
                </div>
                <div class="about-card about-challenge">
                    <h4>Survival</h4>
                    <p>ステージ進行と共に厳しくなるノルマ。一度のミスも許されないプレッシャーの中で、自身の限界到達点を探る上級者向けサバイバル。</p>
                </div>
                <div class="about-card about-multi">
                    <h4>Versus</h4>
                    <p>2〜4人で遊べるリアルタイムバトル。人数に合わせて部屋を作り、同じ色を同時に解いて精度を競い合います。</p>
                </div>
            </div>
        </section>

        <section id="screen-daily" class="screen fade-in">
            <div class="game-header"><h2 class="game-title color-daily">Daily Color</h2><div id="daily-date-display" class="digital-timer" style="font-size:1rem;">202X.XX.XX</div></div>
            <div class="single-color-display"><div id="daily-question-color" class="color-box large-box"></div></div>
            <div class="slider-container glass-panel">
                <div class="slider-row"><label class="label-r">R</label><input type="range" id="daily-R" class="custom-range range-r" min="0" max="255" value="128"><span id="daily-val-R" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-g">G</label><input type="range" id="daily-G" class="custom-range range-g" min="0" max="255" value="128"><span id="daily-val-G" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-b">B</label><input type="range" id="daily-B" class="custom-range range-b" min="0" max="255" value="128"><span id="daily-val-B" class="val-num">128</span></div>
            </div>
            <button id="daily-guess-btn" class="main-action-btn">GUESS</button>
        </section>

        <section id="screen-result-daily" class="screen fade-in result-screen daily-result-bg">
            <div class="daily-res-header">
                <span class="daily-res-label">DAILY CHALLENGE</span>
                <span id="daily-res-date" class="daily-res-date">202X.XX.XX</span>
            </div>
            <div class="score-display"><span class="score-label">SCORE</span><h1 id="daily-score">0%</h1></div>
            <div class="daily-compare-container">
                <div class="daily-color-block">
                    <p class="compare-label">TARGET</p>
                    <div id="daily-ans-color" class="daily-big-box"></div>
                    <span id="daily-ans-text" class="daily-rgb-text">0, 0, 0</span>
                </div>
                <div class="daily-color-block">
                    <p class="compare-label">YOU</p>
                    <div id="daily-your-color" class="daily-big-box"></div>
                    <span id="daily-your-text" class="daily-rgb-text">0, 0, 0</span>
                </div>
            </div>
            <div style="text-align:center; margin-bottom:30px; margin-top:20px; color:rgba(255,255,255,0.7); font-size:0.9rem;">
                Next Color in: <span id="daily-next-timer" style="color:#fff; font-family:var(--font-mono); font-weight:bold;">--:--:--</span>
            </div>
            <div class="modal-buttons">
                <button onclick="app.backToMenu()" class="btn-primary">BACK TO MENU</button>
            </div>
        </section>

        <section id="screen-rush" class="screen fade-in">
            <div class="rush-hud">
                <div class="rush-hud-item">
                    <span class="rush-hud-label">TIME</span>
                    <div id="rush-timer" class="rush-timer-big">60.00</div>
                </div>
                <div class="rush-hud-item">
                    <span class="rush-hud-label">SCORE</span>
                    <div id="rush-current-score" class="rush-score-val">0</div>
                </div>
            </div>
            
            <div id="rush-combo-display" class="rush-combo hidden">0 COMBO</div>
            
            <div id="rush-effect-container" style="position:fixed; top:30%; left:50%; transform:translate(-50%,-50%); pointer-events:none; z-index:100;"></div>

            <div class="color-display-area">
                <div class="color-panel"><span class="panel-label">TARGET</span><div id="rush-question-color" class="color-box"></div></div>
                <div class="color-panel"><span class="panel-label">YOURS</span><div id="rush-input-color" class="color-box"></div></div>
            </div>
            <div class="slider-container glass-panel">
                <div class="slider-row"><label class="label-r">R</label><input type="range" id="rush-R" class="custom-range range-r" min="0" max="255" value="128"><span id="rush-val-R" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-g">G</label><input type="range" id="rush-G" class="custom-range range-g" min="0" max="255" value="128"><span id="rush-val-G" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-b">B</label><input type="range" id="rush-B" class="custom-range range-b" min="0" max="255" value="128"><span id="rush-val-B" class="val-num">128</span></div>
            </div>
            <button id="rush-guess-btn" class="main-action-btn" style="background:var(--accent-green);">GUESS</button>
        </section>

        <section id="screen-result-rush" class="screen fade-in result-screen">
            <h2 class="result-page-title">RUSH RESULT</h2>
            <div id="rush-new-record" class="new-record hidden">NEW HIGH SCORE!</div>
            <div class="score-display"><span class="score-label">TOTAL SCORE</span><h1 id="rush-final-score">0</h1></div>
            
            <div class="stats-row">
                <div class="stat-box"><span class="stat-label">Max Combo</span><span id="rush-max-combo" class="stat-value highlight">0</span></div>
                <div class="stat-box"><span class="stat-label">Correct</span><span id="rush-count" class="stat-value">0</span></div>
                <div class="stat-box"><span class="stat-label">Best Score</span><span id="rush-best" class="stat-value">--</span></div>
            </div>

            <div class="modal-buttons">
                <button onclick="rushGame.init()" class="btn-primary" style="background:var(--accent-green);">RETRY</button>
                <button onclick="app.backToMenu()" class="btn-text">Menu</button>
                <button onclick="rushGame.resetData()" class="btn-text" style="font-size:0.7rem; color:#555;">Reset Data</button>
            </div>
        </section>

        <section id="screen-original" class="screen fade-in">
            <div class="game-header"><h2 class="game-title color-original">Origin</h2></div>
            <div class="single-color-display"><div id="original-question-color" class="color-box large-box"><span class="overlay-text">?</span></div></div>
            <div class="slider-container glass-panel">
                <div class="slider-row"><label class="label-r">R</label><input type="range" id="original-R" class="custom-range range-r" min="0" max="255" value="128"><span id="original-val-R" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-g">G</label><input type="range" id="original-G" class="custom-range range-g" min="0" max="255" value="128"><span id="original-val-G" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-b">B</label><input type="range" id="original-B" class="custom-range range-b" min="0" max="255" value="128"><span id="original-val-B" class="val-num">128</span></div>
            </div>
            <button id="original-guess-btn" class="main-action-btn">GUESS</button>
        </section>

        <section id="screen-result-original" class="screen fade-in result-screen">
            <h2 class="result-page-title">ORIGIN RESULT</h2>
            <div id="original-new-record" class="new-record hidden">NEW RECORD!</div>
            <div class="score-display"><span class="score-label">SCORE</span><h1 id="original-score">0%</h1></div>
            <div class="compare-row">
                <div class="compare-item"><p class="compare-label">TARGET</p><div id="original-ans-color" class="mini-box"></div><span id="original-ans-text"></span></div>
                <div class="compare-item"><p class="compare-label">YOU</p><div id="original-your-color" class="mini-box"></div><span id="original-your-text"></span></div>
            </div>
            <div class="stats-row">
                <div class="stat-box"><span class="stat-label">Personal Best</span><span id="original-pb" class="stat-value highlight">--</span></div>
                <div class="stat-box"><span class="stat-label">Ao5</span><span id="original-ao5" class="stat-value">--</span></div>
            </div>
            <div class="modal-buttons">
                <button onclick="originalGame.nextColor()" class="btn-primary">NEXT COLOR</button>
                <button onclick="originalGame.resetData()" class="btn-text" style="font-size:0.7rem; color:#555;">Reset Data</button>
            </div>
            <div id="original-history" class="history-log"></div>
        </section>

        <section id="screen-challenge" class="screen fade-in">
            <div class="game-header"><h2 class="game-title color-challenge">Survival</h2></div>
            <div class="challenge-status-bar">
                <div class="challenge-info-top">
                    <div><span class="stage-title">STAGE</span><div class="stage-number-big" id="challenge-stage-num">01</div></div>
                    <div class="goal-display"><span class="goal-label">GOAL</span><div class="goal-val" id="challenge-aim-score">90.00%</div></div>
                </div>
            </div>
            <div class="single-color-display"><div id="challenge-sample" class="color-box large-box"><span class="overlay-text">?</span></div></div>
            <div class="slider-container glass-panel">
                <div class="slider-row"><label class="label-r">R</label><input type="range" id="challenge-R" class="custom-range range-r" min="0" max="255" value="128"><span id="challenge-val-R" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-g">G</label><input type="range" id="challenge-G" class="custom-range range-g" min="0" max="255" value="128"><span id="challenge-val-G" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-b">B</label><input type="range" id="challenge-B" class="custom-range range-b" min="0" max="255" value="128"><span id="challenge-val-B" class="val-num">128</span></div>
            </div>
            <button id="challenge-guess-btn" class="main-action-btn">GUESS</button>
        </section>

        <section id="screen-result-challenge" class="screen fade-in result-screen">
            <h2 class="result-page-title">SURVIVAL RESULT</h2>
            <div id="challenge-new-record" class="new-record hidden">MAX STAGE UPDATED!</div>
            <h1 id="challenge-score-text" style="font-size:3rem; margin:10px 0;">Clear!</h1>
            <div class="result-score-block">
                <div class="score-item"><span class="label">SCORE</span><span id="challenge-result-score" class="val">0%</span></div>
                <div class="score-divider">/</div>
                <div class="score-item"><span class="label">GOAL</span><span id="challenge-result-goal" class="val" style="color:var(--accent-green)">0%</span></div>
            </div>
            <div class="compare-row">
                <div class="compare-item"><p class="compare-label">TARGET</p><div id="challenge-ans-color" class="mini-box"></div><span id="challenge-ans-text"></span></div>
                <div class="compare-item"><p class="compare-label">YOU</p><div id="challenge-your-color" class="mini-box"></div><span id="challenge-your-text"></span></div>
            </div>
            <div class="stats-row">
                <div class="stat-box">
                    <span class="stat-label">MAX STAGE</span>
                    <span id="challenge-pb" class="stat-value highlight">1</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="challenge-next-btn" class="btn-primary">NEXT STAGE</button>
                <button onclick="challengeGame.resetData()" class="btn-text" style="font-size:0.7rem; color:#555;">Reset</button>
            </div>
            <div id="challenge-history" class="history-log"></div>
        </section>

        <section id="screen-anotherworld" class="screen fade-in">
            <div class="game-header"><h2 class="game-title color-storage">Color Storage</h2></div>
            <div class="slider-container glass-panel">
                <div class="color-box large-box" id="another-input-color" style="margin-bottom:20px;"></div>
                <div class="slider-row"><label class="label-r">R</label><input type="range" id="another-R" class="custom-range range-r" min="0" max="255" value="128"><span id="another-val-R" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-g">G</label><input type="range" id="another-G" class="custom-range range-g" min="0" max="255" value="128"><span id="another-val-G" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-b">B</label><input type="range" id="another-B" class="custom-range range-b" min="0" max="255" value="128"><span id="another-val-B" class="val-num">128</span></div>
            </div>
            <button class="main-action-btn" onclick="anotherGame.saveColor()">SAVE COLOR</button>
            <div id="another-history" class="history-log" style="margin-top:30px;"></div>
            <div style="text-align:center; margin-top:20px;"><button onclick="anotherGame.resetData()" class="btn-text" style="color:#555;">Delete All</button></div>
        </section>

        <section id="screen-multi-menu" class="screen fade-in" style="text-align:center;">
            <div class="game-header"><h2 class="game-title color-multi">Versus</h2></div>
            <div class="multi-name-area">
                <p class="input-label">YOUR NAME (Max 6)</p>
                <input type="text" id="multi-name-input" maxlength="6" placeholder="Player" class="name-input">
            </div>
            <div class="setting-area">
                <label style="color:#aaa; font-size:0.8rem; display:block; margin-bottom:5px;">GOAL (Wins)</label>
                <input type="number" id="multi-goal-input" class="name-input" placeholder="5" value="5" min="0" style="width:100px; font-size:1.5rem; border-color:var(--primary-multi);">
                <p style="color:#666; font-size:0.7rem; margin-top:5px;">Enter "0" for Endless Mode</p>
            </div>
            <div class="menu-grid">
                <div class="game-card" style="border-color:var(--primary-multi);" onclick="multiGame.createRoom()">
                    <div class="card-icon">🏠</div><div class="card-content"><h3>CREATE ROOM</h3><p>部屋を作成</p></div>
                </div>
                <div class="game-card" style="border-color:var(--primary-multi);" onclick="multiGame.showJoinScreen()">
                    <div class="card-icon">🔑</div><div class="card-content"><h3>JOIN ROOM</h3><p>部屋に参加</p></div>
                </div>
            </div>
        </section>

        <section id="screen-multi-join" class="screen fade-in" style="text-align:center;">
            <div class="game-header"><h2 class="game-title color-multi">Join Room</h2></div>
            <p>Enter 4-digit Room ID</p>
            <input type="tel" pattern="\d*" maxlength="4" id="multi-room-input" placeholder="0000" class="room-id-input" style="border-bottom-color:var(--primary-multi);">
            <button class="main-action-btn" onclick="multiGame.joinRoom()">JOIN</button>
        </section>

        <section id="screen-multi-lobby" class="screen fade-in" style="text-align:center;">
            <div class="game-header"><h2 class="game-title color-multi">Lobby</h2></div>
            <p>Share this Room ID</p>
            <div id="multi-room-id-display" class="room-id-display" style="color:var(--primary-multi);">----</div>
            <div id="multi-lobby-goal" style="color:#fff; font-family:var(--font-mono); margin-bottom:15px; font-weight:bold;">GOAL: ---</div>
            
            <div class="multi-lobby-slots">
                <div id="lobby-slot-1" class="multi-lobby-slot slot-filled"><span class="slot-name">---</span><span class="slot-status">HOST</span></div>
                <div id="lobby-slot-2" class="multi-lobby-slot"><span class="slot-name">Empty</span><span class="slot-status">Waiting...</span></div>
                <div id="lobby-slot-3" class="multi-lobby-slot"><span class="slot-name">Empty</span><span class="slot-status">Waiting...</span></div>
                <div id="lobby-slot-4" class="multi-lobby-slot"><span class="slot-name">Empty</span><span class="slot-status">Waiting...</span></div>
            </div>

            <div id="host-start-area" class="hidden" style="margin-top:20px;">
                <button onclick="multiGame.hostStartGame()" class="main-action-btn" style="background:var(--primary-multi);">START GAME</button>
            </div>
            <p id="multi-status-text" class="status-text" style="margin-top:20px;">Waiting for players...</p>
        </section>

        <section id="screen-multi-battle" class="screen fade-in">
            <div class="game-header"><h2 class="game-title color-multi">Battle</h2><div id="multi-round-display" class="digital-timer" style="font-size:1rem;">Round 1</div></div>
            <div id="multi-opponent-status" class="opponent-status-bar" style="background:rgba(156, 136, 255, 0.1); color:var(--primary-multi); border-color:rgba(156, 136, 255, 0.2);">Waiting for answers...</div>
            <div class="single-color-display"><div id="multi-question-color" class="color-box large-box"></div></div>
            <div class="slider-container glass-panel">
                <div class="slider-row"><label class="label-r">R</label><input type="range" id="multi-R" class="custom-range range-r" min="0" max="255" value="128"><span id="multi-val-R" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-g">G</label><input type="range" id="multi-G" class="custom-range range-g" min="0" max="255" value="128"><span id="multi-val-G" class="val-num">128</span></div>
                <div class="slider-row"><label class="label-b">B</label><input type="range" id="multi-B" class="custom-range range-b" min="0" max="255" value="128"><span id="multi-val-B" class="val-num">128</span></div>
            </div>
            <button id="multi-guess-btn" class="main-action-btn" onclick="multiGame.submitGuess()">GUESS</button>
            <p id="multi-wait-msg" class="hidden" style="text-align:center; color:#888;">Waiting for others...</p>
        </section>

        <section id="screen-multi-result" class="screen fade-in result-screen">
            <h2 id="multi-result-title" class="result-title-style">ROUND WINNER!</h2>
            <div id="multi-final-winner" class="hidden winner-declare"></div>
            
            <div id="multi-result-container"></div>

            <div style="text-align:center; font-family:var(--font-mono); font-size:0.8rem; margin-top:20px; margin-bottom:10px; color:#888;">GOAL: <span id="multi-goal-val" style="color:#fff; font-weight:bold;">5</span></div>

            <div class="multi-compare-wrapper">
                <div class="multi-compare-target">
                    <p class="multi-compare-label" style="color:#fff; font-size:0.9rem;">TARGET</p>
                    <div id="multi-ans-color" class="mini-box large-target-box"></div>
                    <span id="multi-ans-text" class="rgb-value-text"></span>
                </div>
                <div id="multi-players-compare" class="multi-players-wrapper"></div>
            </div>

            <div class="modal-buttons">
                <button id="multi-continue-btn" onclick="multiGame.voteContinue()" class="btn-primary">CONTINUE</button>
                <button onclick="multiGame.confirmExit()" class="btn-text">Exit Room</button>
            </div>
            <p id="multi-continue-status" style="color:#888; font-size:0.8rem; margin-top:-10px; min-height:1.2em;"></p>
        </section>

    </main>

    <footer class="app-footer">
        <div class="copyright" onclick="app.triggerSecret()">&copy; 2023-2025 Takutonkatsu</div>
    </footer>

    <div id="custom-alert-modal" class="custom-modal-overlay hidden">
        <div class="custom-modal-box">
            <p id="custom-alert-text"></p>
            <div class="custom-modal-actions"><button id="custom-alert-ok" class="void-btn btn-set" style="font-size:1rem; padding:10px 20px;">OK</button></div>
        </div>
    </div>
    <div id="custom-confirm-modal" class="custom-modal-overlay hidden">
        <div class="custom-modal-box">
            <p id="custom-confirm-text"></p>
            <div class="custom-modal-actions">
                <button id="custom-confirm-yes" class="void-btn btn-set" style="font-size:1rem; padding:10px 20px;">YES</button>
                <button id="custom-confirm-no" class="void-btn btn-del" style="font-size:1rem; padding:10px 20px;">NO</button>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>